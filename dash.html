<!DOCTYPE html>
<html>
<head>
    <title>TXæŸ¥åˆ†å™¨ä»ªè¡¨æ¿</title>
    <style>
        body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:20px;color:#ffffff;margin:0}.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px;padding:20px;background:rgba(255,255,255,0.1);border-radius:10px;backdrop-filter:blur(10px)}.user-info{display:flex;align-items:center;gap:15px}.username{font-size:18px;font-weight:bold}.btn{padding:10px 20px;background:rgba(255,255,255,0.2);color:white;border:none;border-radius:5px;cursor:pointer;text-decoration:none;font-size:14px;transition:background 0.3s;margin-right:10px}.btn:hover{background:rgba(255,255,255,0.3)}.btn-primary{background:#007bff}.btn-primary:hover{background:#0056b3}.btn-danger{background:#dc3545}.btn-danger:hover{background:#c82333}.container{max-width:1200px;margin:0 auto}.card{background:rgba(255,255,255,0.1);padding:30px;border-radius:10px;margin-bottom:20px;backdrop-filter:blur(10px)}.card h2{margin-top:0;color:#fff}.form-group{margin-bottom:15px}.form-group label{display:block;margin-bottom:5px;font-weight:bold}.form-group input,.form-group select{width:100%;padding:10px;border:none;border-radius:5px;background:rgba(255,255,255,0.9)}.login-type{display:flex;gap:10px;margin-bottom:20px}.login-type-btn{flex:1;padding:10px;background:rgba(255,255,255,0.2);border:none;border-radius:5px;color:white;cursor:pointer}.login-type-btn.active{background:#007bff}.message{padding:10px;border-radius:5px;margin-bottom:15px;text-align:center}.success{background:rgba(40,167,69,0.3);border:1px solid #28a745}.error{background:rgba(220,53,69,0.3);border:1px solid #dc3545}.warning{background:rgba(255,193,7,0.3);border:1px solid #ffc107;color:#fff}.info{background:rgba(23,162,184,0.3);border:1px solid #17a2b8}.hidden{display:none}.links{text-align:center;margin-top:20px}.links a{color:#ffffff;text-decoration:none;margin:0 10px}.page{display:none}.page.active{display:block}.welcome-message{text-align:center;font-size:1.2em;margin-bottom:30px}.dashboard-content{}.remember-me{display:flex;align-items:center;gap:8px;margin:15px 0}.remember-me input{width:auto}.password-hint{font-size:12px;color:#ccc;margin-top:5px}.auto-bind-info{background:rgba(40,167,69,0.2);border:1px solid #28a745;padding:10px;border-radius:5px;margin:10px 0}
        .modern-tabber{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border-radius:16px;padding:24px;margin:20px 0;box-shadow:0 10px 30px rgba(0,0,0,0.2);font-family:'Segoe UI',system-ui,sans-serif}.tabber-nav{display:flex;background:rgba(255,255,255,0.1);backdrop-filter:blur(10px);border-radius:12px;padding:8px;margin-bottom:24px;position:relative;border:1px solid rgba(255,255,255,0.2)}.tab-btn{flex:1;padding:12px 16px;text-align:center;cursor:pointer;border-radius:8px;transition:all 0.3s ease;color:rgba(255,255,255,0.8);font-weight:500;position:relative;z-index:1}.tab-btn span{display:flex;align-items:center;justify-content:center;gap:8px;font-size:14px}.tab-btn:hover{color:white;background:rgba(255,255,255,0.1);transform:translateY(-2px)}.tab-indicator{position:absolute;top:8px;left:8px;height:calc(100% - 16px);width:calc(25% - 16px);background:rgba(255,255,255,0.2);border-radius:8px;transition:all 0.4s cubic-bezier(0.68,-0.55,0.265,1.55);box-shadow:0 4px 15px rgba(0,0,0,0.1)}#modern-tab1:checked~.tabber-nav .tab-indicator{transform:translateX(0%)}#modern-tab2:checked~.tabber-nav .tab-indicator{transform:translateX(100%)}#modern-tab3:checked~.tabber-nav .tab-indicator{transform:translateX(200%)}#modern-tab4:checked~.tabber-nav .tab-indicator{transform:translateX(300%)}#modern-tab1:checked~.tabber-nav label[for="modern-tab1"],#modern-tab2:checked~.tabber-nav label[for="modern-tab2"],#modern-tab3:checked~.tabber-nav label[for="modern-tab3"],#modern-tab4:checked~.tabber-nav label[for="modern-tab4"]{color:white;font-weight:600}.tabber-content{position:relative;min-height:200px}.tab-pane{position:absolute;top:0;left:0;width:100%;opacity:0;transform:translateY(10px);transition:all 0.4s ease;pointer-events:none;color:white}#modern-tab1:checked~.tabber-content .tab-pane:nth-child(1),#modern-tab2:checked~.tabber-content .tab-pane:nth-child(2),#modern-tab3:checked~.tabber-content .tab-pane:nth-child(3),#modern-tab4:checked~.tabber-content .tab-pane:nth-child(4){opacity:1;transform:translateY(0);pointer-events:all}.tab-pane h3{margin:0 0 16px 0;font-size:24px;font-weight:700;background:linear-gradient(45deg,#fff,#e0e7ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent}.tab-pane p{margin:0 0 16px 0;line-height:1.6;opacity:0.9}.placeholder{background:rgba(255,255,255,0.1);border:2px dashed rgba(255,255,255,0.3);border-radius:12px;padding:40px;text-align:center;font-size:18px;color:rgba(255,255,255,0.7);margin-top:16px}.search-box{display:flex;gap:12px;margin-top:20px}.search-box input{flex:1;padding:12px 16px;border:none;border-radius:8px;background:rgba(255,255,255,0.9);font-size:14px}.search-box button{padding:12px 24px;border:none;border-radius:8px;background:#4f46e5;color:white;font-weight:600;cursor:pointer;transition:background 0.3s ease}.search-box button:hover{background:#4338ca}.score-card{display:flex;align-items:center;gap:20px;background:rgba(255,255,255,0.1);padding:20px;border-radius:12px;margin-top:20px}.score-rank{font-size:32px;font-weight:800;color:#fbbf24;text-shadow:0 2px 10px rgba(251,191,36,0.3)}.score-details{flex:1}.score-details div{padding:8px 0;border-bottom:1px solid rgba(255,255,255,0.1)}.score-details div:last-child{border-bottom:none}@media (max-width:768px){.tabber-nav{flex-direction:column;gap:8px}.tab-indicator{display:none}.tab-btn{text-align:left;padding:16px}}
        .suggestions{position:absolute;background:rgba(255,255,255,0.95);border-radius:8px;max-height:200px;overflow-y:auto;width:calc(100% - 24px);margin-top:40px;z-index:1000;box-shadow:0 4px 15px rgba(0,0,0,0.2);display:none}.suggestion-item{padding:10px 15px;cursor:pointer;border-bottom:1px solid #eee;color:#333;font-family:monospace;font-size:12px}.suggestion-item:hover{background:#007bff;color:white}.suggestion-item:last-child{border-bottom:none}.song-table{width:100%;border-collapse:collapse;margin:15px 0;background:rgba(255,255,255,0.1);border-radius:8px;overflow:hidden}.song-table th,.song-table td{padding:12px;text-align:left;border:1px solid rgba(255,255,255,0.2);color:white}.song-table th{background:rgba(255,255,255,0.2);font-weight:bold}.song-table tr:nth-child(even){background:rgba(255,255,255,0.05)}.song-image{max-width:300px;border-radius:8px;margin:10px 0}.difficulty-section{margin:10px 0;padding:10px;background:rgba(255,255,255,0.1);border-radius:5px}.score-card{background:rgba(255,255,255,0.1);padding:15px;border-radius:8px;margin:10px 0}.score-difficulty{font-weight:bold;color:#fbbf24;margin-bottom:8px}
    </style>
</head>
<body>
    <div class="container">
        <div id="loginPage" class="page active">
            <div class="header">
                <h1>ç™»å½• TXæŸ¥åˆ†å™¨</h1>
                <div class="links">
                    <a href="/">è¿”å›é¦–é¡µ</a>
                    <a href="/api?type=help">APIå¸®åŠ©</a>
                </div>
            </div>
            <div class="card">
                <div id="messageArea"></div>
                <div id="autoBindInfo" class="auto-bind-info hidden">
                    <strong>ğŸ’¡ è‡ªåŠ¨ç»‘å®šæç¤ºï¼š</strong>
                    <p>æ–°ç”¨æˆ·æ³¨å†Œæ—¶ä¼šè‡ªåŠ¨ç»‘å®šé»˜è®¤è´¦å·ï¼Œç”¨æˆ·åä¸º <strong>user+æ•°å­—</strong>ï¼Œåˆå§‹å¯†ç ä¸º <strong>123456</strong></p>
                    <p>å¦‚æœå¿˜è®°ç”¨æˆ·åï¼Œå¯ä»¥ä½¿ç”¨SessionTokenç™»å½•ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«å¹¶ç»‘å®š</p>
                </div>
                <div class="login-type">
                    <button class="login-type-btn active" onclick="setLoginType('sessiontoken')">SessionTokenç™»å½•</button>
                    <button class="login-type-btn" onclick="setLoginType('username')">ç”¨æˆ·åç™»å½•</button>
                </div>
                <form id="sessiontokenForm">
                    <div class="form-group">
                        <label for="sessiontoken">SessionToken</label>
                        <input type="text" id="sessiontoken" placeholder="è¾“å…¥ä»»æ„SessionToken" required>
                        <div class="password-hint">ğŸ’¡ å¦‚æœæœªç»‘å®šç”¨æˆ·åï¼Œç›´æ¥ä½¿ç”¨å¯†ç  <strong>123456</strong> ç™»å½•å³å¯ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç»‘å®šé»˜è®¤è´¦å·</div>
                    </div>
                    <div class="form-group">
                        <label for="passwordSession">å¯†ç </label>
                        <input type="password" id="passwordSession" placeholder="è¾“å…¥å¯†ç ï¼ˆé»˜è®¤123456ï¼‰" value="123456">
                        <div class="password-hint">ğŸ’¡ é»˜è®¤å¯†ç ï¼š<strong>123456</strong>ï¼Œç™»å½•åå¯ä¿®æ”¹</div>
                    </div>
                    <div class="remember-me">
                        <input type="checkbox" id="rememberSession">
                        <label for="rememberSession">è®°ä½ç™»å½•çŠ¶æ€</label>
                    </div>
                    <button type="button" class="btn btn-primary" onclick="login()">ç™»å½•</button>
                </form>
                <form id="usernameForm" class="hidden">
                    <div class="form-group">
                        <label for="username">ç”¨æˆ·å</label>
                        <input type="text" id="username" placeholder="è¾“å…¥ç”¨æˆ·å" required>
                    </div>
                    <div class="form-group">
                        <label for="passwordUsername">å¯†ç </label>
                        <input type="password" id="passwordUsername" placeholder="è¾“å…¥å¯†ç " required>
                        <div class="password-hint">ğŸ’¡ <a href="æˆ‘è¿˜æ²¡å†™">å¿˜è®°å¯†ç </a></div>
                    </div>
                    <div class="remember-me">
                        <input type="checkbox" id="rememberUsername">
                        <label for="rememberUsername">è®°ä½ç™»å½•çŠ¶æ€</label>
                    </div>
                    <button type="button" class="btn btn-primary" onclick="login()">ç™»å½•</button>
                </form>
                <div class="links">
                    <p>è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ <a href="javascript:void(0)" onclick="showPage('registerPage')">ç«‹å³æ³¨å†Œ</a></p>
                </div>
            </div>
        </div>

        <div id="registerPage" class="page">
            <div class="header">
                <h1>æ³¨å†Œ TXæŸ¥åˆ†å™¨</h1>
                <div class="links">
                    <a href="/">è¿”å›é¦–é¡µ</a>
                    <a href="/api?type=help">APIå¸®åŠ©</a>
                </div>
            </div>
            <div class="card">
                <div id="registerMessageArea"></div>
                <div class="info">
                    <strong>ğŸ‰ æ³¨å†Œå³ç”¨ï¼š</strong>
                    <p>æ³¨å†ŒæˆåŠŸåï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä¸ºæ‚¨ç»‘å®šé»˜è®¤è´¦å·</p>
                    <p>ç”¨æˆ·åï¼š<strong>user+æ•°å­—</strong>ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰</p>
                    <p>åˆå§‹å¯†ç ï¼š<strong>123456</strong></p>
                    <p>æ‚¨å¯ä»¥åœ¨ç™»å½•åä¿®æ”¹ç”¨æˆ·åå’Œå¯†ç </p>
                </div>
                <form id="registerForm">
                    <div class="form-group">
                        <label for="registerSessiontoken">SessionToken</label>
                        <input type="text" id="registerSessiontoken" placeholder="è¾“å…¥ä»»æ„SessionToken" required>
                        <div class="password-hint">ğŸ’¡ æ— éœ€éªŒè¯ï¼Œå¯è¾“å…¥ä»»æ„SessionTokenï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç»‘å®šé»˜è®¤è´¦å·</div>
                    </div>
                    <div class="remember-me">
                        <input type="checkbox" id="rememberRegister">
                        <label for="rememberRegister">è®°ä½ç™»å½•çŠ¶æ€</label>
                    </div>
                    <button type="button" class="btn btn-primary" onclick="register()">æ³¨å†Œ</button>
                </form>
                <div class="links">
                    <p>å·²æœ‰è´¦å·ï¼Ÿ <a href="javascript:void(0)" onclick="showPage('loginPage')">ç«‹å³ç™»å½•</a></p>
                </div>
            </div>
        </div>

        <div id="dashboardPage" class="page">
            <div class="header">
                <h1>TXæŸ¥åˆ†å™¨ä»ªè¡¨æ¿</h1>
                <div class="user-info">
                    <span class="username" id="usernameDisplay">åŠ è½½ä¸­...</span>
                    <button class="btn" onclick="showConfig()">é…ç½®</button>
                    <button class="btn btn-danger" onclick="logout()">é€€å‡º</button>
                </div>
            </div>
            <div class="dashboard-content">
                <div class="card">
                    <div class="welcome-message">
                        <h2>æ¬¢è¿ä½¿ç”¨TXæŸ¥åˆ†å™¨ï¼</h2>
                        <p>è¯·é€‰æ‹©åŠŸèƒ½</p>
                    </div>
                    <div class="modern-tabber">
                        <input type="radio" name="modern-tab" id="modern-tab1" checked hidden>
                        <input type="radio" name="modern-tab" id="modern-tab2" hidden>
                        <input type="radio" name="modern-tab" id="modern-tab3" hidden>
                        <input type="radio" name="modern-tab" id="modern-tab4" hidden>
                        <div class="tabber-nav">
                            <label for="modern-tab1" class="tab-btn"><span>è·å–B30å›¾ç‰‡</span></label>
                            <label for="modern-tab2" class="tab-btn"><span>è·å–B30æ–‡å­—</span></label>
                            <label for="modern-tab3" class="tab-btn"><span>æ­Œæ›²ä¿¡æ¯æŸ¥è¯¢</span></label>
                            <label for="modern-tab4" class="tab-btn"><span>å•æ›²æˆç»©è¯¦æƒ…</span></label>
                            <div class="tab-indicator"></div>
                        </div>
                        <div class="tabber-content">
                            <div class="tab-pane">
                                <p>è¾“å…¥Bæ•°ï¼š</p>
                                <input type="text" id="best">
                                <p>è¾“å…¥Pæ•°ï¼š</p>
                                <input type="text" id="phi">
                                <p>è‡ªå®šä¹‰æ–‡æ¡ˆï¼ˆå¯é€‰ï¼‰ï¼š<br>æš‚æœªæ”¯æŒ</p><br>
                                <p>è‡ªå®šä¹‰XMLï¼ˆå¯é€‰ï¼‰ï¼š<br>æš‚æœªæ”¯æŒ</p><br>
                                <button onclick="getImage()">ç”Ÿæˆå›¾ç‰‡</button>
                                <script>
                                function getImage() {
                                    let Best = document.getElementById('best').value;
                                    let Phi = document.getElementById('phi').value;
                                    var token = document.getElementById("sessionToken")?.textContent || '';
                                    var button = document.querySelector('button[onclick="getImage()"]');
                                    button.insertAdjacentHTML('afterend', `<div style="margin-top:10px;"><div id="loading">å›¾ç‰‡ç”Ÿæˆä¸­...</div><img src="/api?sessiontoken=${token}&best=${Best}&phi=${Phi}&type=image" style="max-width:100%;height:auto;display:block;" onload="document.getElementById('loading').style.display='none';" onerror="document.getElementById('loading').innerHTML='å›¾ç‰‡ç”Ÿæˆå¤±è´¥';"></div>`);
                                }
                                </script>
                            </div>
                            <div class="tab-pane">
                                <h3>B30æ–‡å­—æ•°æ®</h3>
                                <p>è¾“å…¥Bæ•°ï¼š</p>
                                <input type="number" id="bests2" value="30">
                                <p>è¾“å…¥Pæ•°ï¼š</p>
                                <input type="number" id="phi2" value="3">
                                <label><input type="checkbox" id="rawResponse"> åŸå“åº”</label>
                                <button onclick="getData()">ç”Ÿæˆæ•°æ®</button>
                                <div id="output" style="margin-top:15px;white-space:pre-wrap;font-family:monospace;padding:10px;border-radius:5px;"></div>
                                <script>
                                function getData() {
                                    const Best = document.getElementById('bests2')?.value || '';
                                    const Phi = document.getElementById('phi2')?.value || '';
                                    const token = document.getElementById("sessionToken")?.textContent || '';
                                    const isRawResponse = document.getElementById('rawResponse')?.checked || false;
                                    if (!Best.trim() || !Phi.trim()) {
                                        document.getElementById('output').innerHTML = 'é”™è¯¯ï¼šè¯·å¡«å†™Bæ•°å’ŒPæ•°';
                                        return;
                                    }
                                    const bestNum = parseInt(Best);
                                    const phiNum = parseInt(Phi);
                                    if (isNaN(bestNum) || isNaN(phiNum)) {
                                        document.getElementById('output').innerHTML = 'é”™è¯¯ï¼šBæ•°å’ŒPæ•°å¿…é¡»æ˜¯æœ‰æ•ˆæ•°å­—';
                                        return;
                                    }
                                    const url = `/api?type=get&sessiontoken=${encodeURIComponent(token)}&best=${bestNum}&phi=${phiNum}&ifNotImage=true`;
                                    const output = document.getElementById('output');
                                    if (output) {
                                        output.innerHTML = 'åŠ è½½ä¸­...';
                                        fetch(url).then(response => {
                                            if (!response.ok) throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                                            return response.json();
                                        }).then(data => {
                                            if (isRawResponse) output.innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                                            else output.innerHTML = formatResponseToText(data);
                                        }).catch(error => output.innerHTML = 'è¯·æ±‚å¤±è´¥: ' + error.message);
                                    }
                                }
                                function formatResponseToText(data) {
                                    if (!data || data.code !== 200) return 'è¯·æ±‚å¤±è´¥: ' + (data?.message || 'æœªçŸ¥é”™è¯¯') + '\nçŠ¶æ€ç : ' + (data?.code || 'æœªçŸ¥');
                                    const userInfo = data.data?.user_info;
                                    const list = data.data?.list;
                                    if (!userInfo || !list) return 'æ•°æ®æ ¼å¼é”™è¯¯ï¼šç¼ºå°‘å¿…è¦å­—æ®µ';
                                    let result = '';
                                    result += `åç§°ï¼š${data.nickname || data.data?.nickname || 'æœªçŸ¥'}\n`;
                                    result += `RKSï¼š${userInfo.rks || 0}\n`;
                                    result += `EZæƒ…å†µï¼š${userInfo.EZ?.[0] || 0}C ${userInfo.EZ?.[1] || 0}FC ${userInfo.EZ?.[2] || 0}AP\n`;
                                    result += `HDæƒ…å†µï¼š${userInfo.HD?.[0] || 0}C ${userInfo.HD?.[1] || 0}FC ${userInfo.HD?.[2] || 0}AP\n`;
                                    result += `INæƒ…å†µï¼š${userInfo.IN?.[0] || 0}C ${userInfo.IN?.[1] || 0}FC ${userInfo.IN?.[2] || 0}AP\n`;
                                    result += `ATæƒ…å†µï¼š${userInfo.AT?.[0] || 0}C ${userInfo.AT?.[1] || 0}FC ${userInfo.AT?.[2] || 0}AP\n\n`;
                                    if (list._phi) {
                                        result += "Phiåˆ—è¡¨ï¼š\n";
                                        Object.keys(list._phi).forEach(key => {
                                            const phi = list._phi[key];
                                            const bestData = list._best?.[key];
                                            if (bestData) {
                                                const rating = getRating(bestData.score, bestData.fc, bestData.acc);
                                                result += `Phi${key} ${phi.id} ${phi.level.split(' ')[0]} ${phi.level.split(' ')[1]} ${bestData.score} ${rating} ${bestData.acc.toFixed(2)}\n`;
                                            } else result += `Phi${key} ${phi.id} ${phi.level.split(' ')[0]} ${phi.level.split(' ')[1]}\n`;
                                        });
                                        result += "\n";
                                    }
                                    if (list._best) {
                                        result += "Beståˆ—è¡¨ï¼š\n";
                                        Object.keys(list._best).forEach(key => {
                                            const best = list._best[key];
                                            const rating = getRating(best.score, best.fc, best.acc);
                                            result += `Best${key} ${best.id} ${best.difficulty} ${best.base_level} ${best.score} ${rating} ${best.acc.toFixed(2)}\n`;
                                        });
                                        result += "\n";
                                    }
                                    result += "Generated by TeinxictionMC";
                                    return result;
                                }
                                function getRating(score, fc, acc) {
                                    if (score === 1000000) return "AP";
                                    if (score >= 960000) return "V";
                                    if (score >= 920000) return "S";
                                    if (score >= 880000) return "A";
                                    if (score >= 820000) return "B";
                                    if (score >= 700000) return "C";
                                    if (fc) return "FC";
                                    return "F";
                                }
                                </script>
                            </div>
                            <div class="tab-pane">
                                <h3>æ­Œæ›²ä¿¡æ¯æŸ¥è¯¢</h3>
                                <div class="search-box">
                                    <input type="text" id="songSearch" placeholder="è¾“å…¥æ›²ç›®IDæˆ–åç§°..." oninput="searchSongs()">
                                    <div id="searchSuggestions" class="suggestions"></div>
                                </div>
                                <div style="margin:15px 0">
                                    <label style="color:white"><input type="checkbox" id="showAllSongs"> æŸ¥çœ‹å…¨éƒ¨ä¿¡æ¯</label>
                                    <label style="color:white;margin-left:15px"><input type="checkbox" id="rawSongResponse"> åŸå“åº”</label>
                                    <button onclick="getSongInfo()" style="margin-left:15px">æŸ¥è¯¢</button>
                                </div>
                                <div id="songResult"></div>
                            </div>
                            <div class="tab-pane">
                                <h3>å•æ›²æˆç»©è¯¦æƒ…</h3>
                                <div class="search-box">
                                    <input type="text" id="scoreSearch" placeholder="è¾“å…¥æ›²ç›®ID..." oninput="searchScores()">
                                    <div id="scoreSuggestions" class="suggestions"></div>
                                </div>
                                <div style="margin:15px 0">
                                    <label style="color:white"><input type="checkbox" id="rawScoreResponse"> åŸå“åº”</label>
                                    <button onclick="getScoreInfo()" style="margin-left:15px">æŸ¥è¯¢æˆç»©</button>
                                </div>
                                <div id="scoreResult"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="configPage" class="page">
            <div class="header">
                <h1>è´¦æˆ·é…ç½®</h1>
                <div class="user-info">
                    <button class="btn" onclick="showPage('dashboardPage')">è¿”å›ä»ªè¡¨æ¿</button>
                </div>
            </div>
            <div class="card">
                <h2>è´¦æˆ·ç®¡ç†</h2>
                <div id="configMessageArea"></div>
                <div class="form-group">
                    <h3>ç”¨æˆ·ä¿¡æ¯</h3>
                    <p><strong>ç”¨æˆ·ID:</strong> <span id="userId"></span></p>
                    <p><strong>ç”¨æˆ·å:</strong> <span id="usernameInfo"></span></p>
                    <p><strong>SessionToken:</strong> <span id="sessionToken"></span></p>
                    <p><strong>æ³¨å†Œæ—¶é—´:</strong> <span id="createdAt"></span></p>
                    <p><strong>è´¦å·çŠ¶æ€:</strong> <span id="accountStatus"></span></p>
                </div>
                <div id="bindAccountForm">
                    <h3>ç»‘å®š/ä¿®æ”¹ç”¨æˆ·åå’Œå¯†ç </h3>
                    <div class="form-group">
                        <label for="bindUsername">æ–°ç”¨æˆ·å</label>
                        <input type="text" id="bindUsername" placeholder="è¾“å…¥æ–°ç”¨æˆ·å">
                        <div class="password-hint">ç”¨æˆ·åå¿…é¡»å”¯ä¸€ï¼Œä¸èƒ½ä¸å…¶ä»–ç”¨æˆ·é‡å¤</div>
                    </div>
                    <div class="form-group">
                        <label for="bindPassword">æ–°å¯†ç </label>
                        <input type="password" id="bindPassword" placeholder="è¾“å…¥æ–°å¯†ç ">
                    </div>
                    <button class="btn btn-primary" onclick="bindAccount()">ä¿å­˜ä¿®æ”¹</button>
                </div>
                <div id="unbindAccountSection" class="hidden">
                    <h3>è´¦å·ç®¡ç†</h3>
                    <p>å½“å‰å·²ç»‘å®šç”¨æˆ·åå’Œå¯†ç </p>
                    <button class="btn btn-danger" onclick="unbindAccount()">è§£ç»‘è´¦å·</button>
                    <div class="password-hint">âš ï¸ è§£ç»‘ååªèƒ½ä½¿ç”¨SessionTokenç™»å½•ï¼Œä¸”éœ€è¦é‡æ–°è®¾ç½®å¯†ç </div>
                </div>
                <div style="margin-top:30px;padding-top:20px;border-top:1px solid rgba(255,255,255,0.3)">
                    <h3>ç™»å½•è®¾ç½®</h3>
                    <div class="remember-me">
                        <input type="checkbox" id="globalRemember">
                        <label for="globalRemember">è®°ä½ç™»å½•çŠ¶æ€ï¼ˆ30å¤©å…ç™»å½•ï¼‰</label>
                    </div>
                    <button class="btn" onclick="saveRememberSetting()">ä¿å­˜è®¾ç½®</button>
                </div>
                <div style="margin-top:30px;padding-top:20px;border-top:1px solid rgba(255,255,255,0.3)">
                    <h3 style="color:#dc3545">å±é™©æ“ä½œ</h3>
                    <p>æ°¸ä¹…åˆ é™¤è´¦æˆ·å°†æ¸…é™¤æ‰€æœ‰æ•°æ®ä¸”ä¸å¯æ¢å¤</p>
                    <div class="form-group">
                        <label for="deletePassword">ç¡®è®¤å¯†ç </label>
                        <input type="password" id="deletePassword" placeholder="è¾“å…¥å¯†ç ç¡®è®¤åˆ é™¤">
                    </div>
                    <button class="btn btn-danger" onclick="deleteAccount()">æ°¸ä¹…åˆ é™¤è´¦æˆ·</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ­Œæ›²ä¿¡æ¯æŸ¥è¯¢å’Œæˆç»©æŸ¥è¯¢çš„JavaScriptä»£ç 
        let allSongsData = null;
        let userScoresData = null;

        function searchSongs() {
            const input = document.getElementById('songSearch');
            const suggestions = document.getElementById('searchSuggestions');
            const query = input.value.toLowerCase();
            if (!query) { suggestions.style.display = 'none'; return; }
            if (!allSongsData) { loadAllSongs(); return; }
            const matches = [];
            for (const [id, song] of Object.entries(allSongsData)) {
                if (id.toLowerCase().includes(query) || song.name.toLowerCase().includes(query)) {
                    matches.push({id, name: song.name});
                    if (matches.length >= 10) break;
                }
            }
            if (matches.length > 0) {
                suggestions.innerHTML = matches.map(song => `<div class="suggestion-item" onclick="selectSong('${song.id}')"><strong>${song.id}</strong><br><small>${song.name}</small></div>`).join('');
                suggestions.style.display = 'block';
            } else suggestions.style.display = 'none';
        }

        function selectSong(songId) {
            document.getElementById('songSearch').value = songId;
            document.getElementById('searchSuggestions').style.display = 'none';
        }

        function searchScores() {
            const input = document.getElementById('scoreSearch');
            const suggestions = document.getElementById('scoreSuggestions');
            const query = input.value.toLowerCase();
            if (!query) { suggestions.style.display = 'none'; return; }
            if (!userScoresData) { loadUserScores(); return; }
            const matches = [];
            for (const [id, score] of Object.entries(userScoresData)) {
                if (id.toLowerCase().includes(query)) {
                    matches.push(id);
                    if (matches.length >= 10) break;
                }
            }
            if (matches.length > 0) {
                suggestions.innerHTML = matches.map(id => `<div class="suggestion-item" onclick="selectScore('${id}')">${id}</div>`).join('');
                suggestions.style.display = 'block';
            } else suggestions.style.display = 'none';
        }

        function selectScore(songId) {
            document.getElementById('scoreSearch').value = songId;
            document.getElementById('scoreSuggestions').style.display = 'none';
        }

        async function loadAllSongs() {
            try {
                const response = await fetch('/api?type=data');
                const data = await response.json();
                if (data.code === 200) {
                    allSongsData = data.data;
                    searchSongs();
                }
            } catch (error) { console.error('åŠ è½½æ­Œæ›²æ•°æ®å¤±è´¥:', error); }
        }

        async function loadUserScores() {
            const token = document.getElementById("sessionToken")?.textContent || '';
            if (!token) { alert('è¯·å…ˆç™»å½•'); return; }
            try {
                const response = await fetch(`/api?type=get&sessiontoken=${encodeURIComponent(token)}&best=30&phi=3&ifNotImage=true`);
                const data = await response.json();
                if (data.code === 200) {
                    const firstKey = Object.keys(data.data.save_data)[0];
                    userScoresData = data.data.save_data[firstKey];
                    searchScores();
                }
            } catch (error) { console.error('åŠ è½½æˆç»©æ•°æ®å¤±è´¥:', error); }
        }

        async function getSongInfo() {
            const showAll = document.getElementById('showAllSongs').checked;
            const rawResponse = document.getElementById('rawSongResponse').checked;
            const searchInput = document.getElementById('songSearch').value;
            try {
                const response = await fetch('/api?type=data');
                const data = await response.json();
                if (data.code !== 200) {
                    document.getElementById('songResult').innerHTML = 'è·å–æ•°æ®å¤±è´¥';
                    return;
                }
                if (rawResponse) {
                    if (showAll) document.getElementById('songResult').innerHTML = `<pre>${JSON.stringify(data.data, null, 2)}</pre>`;
                    else if (searchInput) {
                        const songData = data.data[searchInput];
                        if (songData) document.getElementById('songResult').innerHTML = `<pre>${JSON.stringify(songData, null, 2)}</pre>`;
                        else document.getElementById('songResult').innerHTML = 'æœªæ‰¾åˆ°è¯¥æ›²ç›®';
                    } else document.getElementById('songResult').innerHTML = 'è¯·è¾“å…¥æ›²ç›®ID';
                } else {
                    if (showAll) document.getElementById('songResult').innerHTML = formatAllSongs(data.data);
                    else if (searchInput) {
                        const songData = data.data[searchInput];
                        if (songData) document.getElementById('songResult').innerHTML = formatSongInfo(searchInput, songData);
                        else document.getElementById('songResult').innerHTML = 'æœªæ‰¾åˆ°è¯¥æ›²ç›®';
                    } else document.getElementById('songResult').innerHTML = 'è¯·è¾“å…¥æ›²ç›®ID';
                }
            } catch (error) { document.getElementById('songResult').innerHTML = 'è¯·æ±‚å¤±è´¥: ' + error.message; }
        }

        function formatAllSongs(songsData) {
            let html = '<div style="max-height:600px;overflow-y:auto"><table class="song-table"><tr><th>ID</th><th>åç§°</th><th>æ›²å¸ˆ</th><th>ç”»å¸ˆ</th><th>éš¾åº¦</th></tr>';
            for (const [id, song] of Object.entries(songsData)) {
                const difficulties = [];
                if (song.ez) difficulties.push(`EZ:${song.ez.level}`);
                if (song.hd) difficulties.push(`HD:${song.hd.level}`);
                if (song.in) difficulties.push(`IN:${song.in.level}`);
                if (song.at) difficulties.push(`AT:${song.at.level}`);
                html += `<tr><td><small>${id}</small></td><td>${song.name || 'æœªçŸ¥'}</td><td>${song.composer || 'æœªçŸ¥'}</td><td>${song.ill || 'æœªçŸ¥'}</td><td>${difficulties.join(', ')}</td></tr>`;
            }
            html += '</table></div>';
            return html;
        }

        function formatSongInfo(songId, songData) {
            let html = `<img src="/illustration/${songId}.png" alt="${songData.name}" class="song-image" onerror="this.style.display='none'">`;
            html += `<table class="song-table"><tr><th colspan="4" style="text-align:center">${songData.name || 'æœªçŸ¥'}</th></tr>`;
            html += `<tr><td colspan="4">æ›²å¸ˆï¼š${songData.composer || 'æœªçŸ¥'} | ç”»å¸ˆï¼š${songData.ill || 'æœªçŸ¥'} | IDï¼š${songId}</td></tr>`;
            html += `<tr><th>éš¾åº¦</th><th>å®šæ•°</th><th>Noteæ•°</th><th>è°±å¸ˆ</th></tr>`;
            if (songData.ez) html += `<tr><td>EZ</td><td>${songData.ez.level}</td><td>${songData.ez.notes}<br><small>Tap:${songData.ez.tap} Hold:${songData.ez.hold} Drag:${songData.ez.drag} Flick:${songData.ez.flick}</small></td><td>${songData.ez.charter}</td></tr>`;
            if (songData.hd) html += `<tr><td>HD</td><td>${songData.hd.level}</td><td>${songData.hd.notes}<br><small>Tap:${songData.hd.tap} Hold:${songData.hd.hold} Drag:${songData.hd.drag} Flick:${songData.hd.flick}</small></td><td>${songData.hd.charter}</td></tr>`;
            if (songData.in) html += `<tr><td>IN</td><td>${songData.in.level}</td><td>${songData.in.notes}<br><small>Tap:${songData.in.tap} Hold:${songData.in.hold} Drag:${songData.in.drag} Flick:${songData.in.flick}</small></td><td>${songData.in.charter}</td></tr>`;
            if (songData.at) html += `<tr><td>AT</td><td>${songData.at.level}</td><td>${songData.at.notes}<br><small>Tap:${songData.at.tap} Hold:${songData.at.hold} Drag:${songData.at.drag} Flick:${songData.at.flick}</small></td><td>${songData.at.charter}</td></tr>`;
            html += `</table>`;
            return html;
        }

        async function getScoreInfo() {
            const token = document.getElementById("sessionToken")?.textContent || '';
            const rawResponse = document.getElementById('rawScoreResponse').checked;
            const searchInput = document.getElementById('scoreSearch').value;
            if (!token) { alert('è¯·å…ˆç™»å½•'); return; }
            try {
                const response = await fetch(`/api?type=get&sessiontoken=${encodeURIComponent(token)}&best=30&phi=3&ifNotImage=true`);
                const data = await response.json();
                if (data.code !== 200) {
                    document.getElementById('scoreResult').innerHTML = 'è·å–æ•°æ®å¤±è´¥';
                    return;
                }
                const firstKey = Object.keys(data.data.save_data)[0];
                const scoresData = data.data.save_data[firstKey];
                if (rawResponse) {
                    if (searchInput) {
                        const scoreData = scoresData[searchInput];
                        if (scoreData) document.getElementById('scoreResult').innerHTML = `<pre>${JSON.stringify(scoreData, null, 2)}</pre>`;
                        else document.getElementById('scoreResult').innerHTML = 'æœªæ‰¾åˆ°è¯¥æ›²ç›®çš„æˆç»©';
                    } else document.getElementById('scoreResult').innerHTML = `<pre>${JSON.stringify(scoresData, null, 2)}</pre>`;
                } else {
                    if (searchInput) {
                        const scoreData = scoresData[searchInput] || {EZ: { acc: 0, fc: 0, score: 0 },HD: { acc: 0, fc: 0, score: 0 },IN: { acc: 0, fc: 0, score: 0 },AT: { acc: 0, fc: 0, score: 0 }};
                        document.getElementById('scoreResult').innerHTML = formatScoreInfo(searchInput, scoreData);
                    } else document.getElementById('scoreResult').innerHTML = 'è¯·è¾“å…¥æ›²ç›®ID';
                }
            } catch (error) { document.getElementById('scoreResult').innerHTML = 'è¯·æ±‚å¤±è´¥: ' + error.message; }
        }

        function formatScoreInfo(songId, scoreData) {
            function getRating(score, fc) {
                if (score === 1000000) return "AP";
                if (score >= 960000) return "V";
                if (score >= 920000) return "S";
                if (score >= 880000) return "A";
                if (score >= 820000) return "B";
                if (score >= 700000) return "C";
                if (fc) return "FC";
                return "F";
            }
            let html = `<div class="score-card"><h4>${songId}</h4>`;
            if (scoreData.EZ) {
                const rating = getRating(scoreData.EZ.score, scoreData.EZ.fc);
                html += `<div class="score-difficulty">EZ</div><div>å‡†åº¦: ${scoreData.EZ.acc.toFixed(2)}% | è¯„çº§: ${rating} | åˆ†æ•°: ${scoreData.EZ.score}</div>`;
            }
            if (scoreData.HD) {
                const rating = getRating(scoreData.HD.score, scoreData.HD.fc);
                html += `<div class="score-difficulty">HD</div><div>å‡†åº¦: ${scoreData.HD.acc.toFixed(2)}% | è¯„çº§: ${rating} | åˆ†æ•°: ${scoreData.HD.score}</div>`;
            }
            if (scoreData.IN) {
                const rating = getRating(scoreData.IN.score, scoreData.IN.fc);
                html += `<div class="score-difficulty">IN</div><div>å‡†åº¦: ${scoreData.IN.acc.toFixed(2)}% | è¯„çº§: ${rating} | åˆ†æ•°: ${scoreData.IN.score}</div>`;
            }
            if (scoreData.AT) {
                const rating = getRating(scoreData.AT.score, scoreData.AT.fc);
                html += `<div class="score-difficulty">AT</div><div>å‡†åº¦: ${scoreData.AT.acc.toFixed(2)}% | è¯„çº§: ${rating} | åˆ†æ•°: ${scoreData.AT.score}</div>`;
            }
            html += `</div>`;
            return html;
        }

        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => { loadAllSongs(); }, 1000);
        });

        // åŸæœ‰çš„ç”¨æˆ·è®¤è¯JavaScriptä»£ç ä¿æŒä¸å˜
        let currentLoginType = 'sessiontoken';
        let currentUser = null;
        let hash = window.location.hash.substring(1);
        
        document.addEventListener('DOMContentLoaded', function() {
            checkRememberMe();
            if (hash) {
                if (hash === 'login' || hash === 'register') showPage(hash + 'Page');
                else if (isLoggedIn()) showPage('dashboardPage');
                else showPage('loginPage');
            } else if (isLoggedIn()) { showPage('dashboardPage'); loadUserInfo(); }
            else showPage('loginPage');
        });
        
        function checkRememberMe() {
            const rememberMe = getCookie('remember_me');
            const savedUsername = getCookie('username');
            if (rememberMe === 'true' && savedUsername) {
                document.getElementById('username').value = savedUsername;
                document.getElementById('rememberUsername').checked = true;
                document.getElementById('rememberSession').checked = true;
                document.getElementById('rememberRegister').checked = true;
                document.getElementById('globalRemember').checked = true;
                document.getElementById('autoBindInfo').classList.remove('hidden');
            }
        }
        
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            return null;
        }
        
        function isLoggedIn() { return currentUser !== null; }
        
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            window.location.hash = pageId.replace('Page', '');
        }
        
        function setLoginType(type) {
            currentLoginType = type;
            document.querySelectorAll('.login-type-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            if (type === 'sessiontoken') {
                document.getElementById('sessiontokenForm').classList.remove('hidden');
                document.getElementById('usernameForm').classList.add('hidden');
            } else {
                document.getElementById('sessiontokenForm').classList.add('hidden');
                document.getElementById('usernameForm').classList.remove('hidden');
            }
        }
        
        async function login() {
            let data = {};
            let rememberMe = false;
            if (currentLoginType === 'sessiontoken') {
                const sessiontoken = document.getElementById('sessiontoken').value;
                const password = document.getElementById('passwordSession').value;
                rememberMe = document.getElementById('rememberSession').checked;
                if (!sessiontoken) { showMessage('loginPage', 'è¯·è¾“å…¥SessionToken', 'error'); return; }
                data = { type: 'sessiontoken', sessiontoken: sessiontoken, password: password };
            } else {
                const username = document.getElementById('username').value;
                const password = document.getElementById('passwordUsername').value;
                rememberMe = document.getElementById('rememberUsername').checked;
                if (!username || !password) { showMessage('loginPage', 'è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ', 'error'); return; }
                data = { type: 'username', username: username, password: password };
            }
            try {
                const response = await fetch('/api/dash/login', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
                const result = await response.json();
                if (result.code === 200) {
                    if (rememberMe) await saveRememberSettingToServer(result.username || data.username, true);
                    if (result.auto_bind) showMessage('loginPage', `ç™»å½•æˆåŠŸï¼å·²è‡ªåŠ¨ç»‘å®šé»˜è®¤è´¦å·ï¼š${result.username}ï¼Œåˆå§‹å¯†ç ï¼š${result.default_password}`, 'success');
                    else showMessage('loginPage', 'ç™»å½•æˆåŠŸï¼Œæ­£åœ¨è·³è½¬...', 'success');
                    currentUser = { username: result.username || data.username };
                    setTimeout(() => { showPage('dashboardPage'); loadUserInfo(); }, result.auto_bind ? 3000 : 1000);
                } else showMessage('loginPage', 'ç™»å½•å¤±è´¥: ' + result.error, 'error');
            } catch (error) { showMessage('loginPage', 'ç½‘ç»œé”™è¯¯: ' + error.message, 'error'); }
        }
        
        async function register() {
            const sessiontoken = document.getElementById('registerSessiontoken').value;
            const rememberMe = document.getElementById('rememberRegister').checked;
            if (!sessiontoken) { showMessage('registerPage', 'è¯·è¾“å…¥SessionToken', 'error'); return; }
            try {
                const response = await fetch('/api/dash/register', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ sessiontoken: sessiontoken }) });
                const result = await response.json();
                if (result.code === 200) {
                    if (rememberMe) await saveRememberSettingToServer(result.username, true);
                    showMessage('registerPage', `æ³¨å†ŒæˆåŠŸï¼å·²è‡ªåŠ¨ç»‘å®šé»˜è®¤è´¦å·ï¼š${result.username}ï¼Œåˆå§‹å¯†ç ï¼š${result.default_password}`, 'success');
                    currentUser = { username: result.username };
                    setTimeout(() => { showPage('dashboardPage'); loadUserInfo(); }, 3000);
                } else showMessage('registerPage', 'æ³¨å†Œå¤±è´¥: ' + result.error, 'error');
            } catch (error) { showMessage('registerPage', 'ç½‘ç»œé”™è¯¯: ' + error.message, 'error'); }
        }
        
        async function saveRememberSettingToServer(username, rememberMe) {
            try {
                await fetch('/api/dash/remember-login', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ username: username, remember_me: rememberMe }) });
            } catch (error) { console.error('ä¿å­˜è®°ä½å¯†ç è®¾ç½®å¤±è´¥:', error); }
        }
        
        async function saveRememberSetting() {
            const rememberMe = document.getElementById('globalRemember').checked;
            if (currentUser && currentUser.username) {
                await saveRememberSettingToServer(currentUser.username, rememberMe);
                showMessage('configPage', 'è®¾ç½®å·²ä¿å­˜', 'success');
            }
        }
        
        async function loadUserInfo() {
            try {
                const response = await fetch('/api/dash/user-info');
                const data = await response.json();
                if (data.code === 200) {
                    currentUser = data.data;
                    updateUserDisplay();
                } else showMessage('dashboardPage', 'è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥: ' + data.error, 'error');
            } catch (error) { showMessage('dashboardPage', 'ç½‘ç»œé”™è¯¯: ' + error.message, 'error'); }
        }
        
        function updateUserDisplay() {
            const username = currentUser.username || 'æœªç»‘å®šç”¨æˆ·å';
            const hasPassword = currentUser.has_password;
            document.getElementById('usernameDisplay').textContent = username;
            document.getElementById('userId').textContent = currentUser.user_id;
            document.getElementById('usernameInfo').textContent = username;
            document.getElementById('sessionToken').textContent = currentUser.sessiontoken;
            document.getElementById('createdAt').textContent = currentUser.created_at;
            document.getElementById('accountStatus').textContent = hasPassword ? 'å·²ç»‘å®š' : 'æœªç»‘å®š';
            document.getElementById('accountStatus').style.color = hasPassword ? '#28a745' : '#dc3545';
            if (hasPassword) {
                document.getElementById('bindAccountForm').classList.remove('hidden');
                document.getElementById('unbindAccountSection').classList.remove('hidden');
            } else {
                document.getElementById('bindAccountForm').classList.add('hidden');
                document.getElementById('unbindAccountSection').classList.add('hidden');
            }
        }
        
        async function bindAccount() {
            const username = document.getElementById('bindUsername').value;
            const password = document.getElementById('bindPassword').value;
            if (!username || !password) { showMessage('configPage', 'è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ', 'error'); return; }
            try {
                const response = await fetch('/api/dash/bind-account', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ username: username, password: password }) });
                const data = await response.json();
                if (data.code === 200) {
                    showMessage('configPage', 'è´¦å·ç»‘å®šæˆåŠŸ', 'success');
                    document.getElementById('bindUsername').value = '';
                    document.getElementById('bindPassword').value = '';
                    loadUserInfo();
                } else showMessage('configPage', 'ç»‘å®šå¤±è´¥: ' + data.error, 'error');
            } catch (error) { showMessage('configPage', 'ç½‘ç»œé”™è¯¯: ' + error.message, 'error'); }
        }
        
        async function unbindAccount() {
            if (!confirm('ç¡®å®šè¦è§£ç»‘ç”¨æˆ·åå’Œå¯†ç å—ï¼Ÿè§£ç»‘ååªèƒ½ä½¿ç”¨SessionTokenç™»å½•ï¼Œä¸”éœ€è¦é‡æ–°è®¾ç½®å¯†ç ã€‚')) return;
            try {
                const response = await fetch('/api/dash/unbind-account', { method: 'POST', headers: { 'Content-Type': 'application/json' } });
                const data = await response.json();
                if (data.code === 200) {
                    showMessage('configPage', 'è´¦å·è§£ç»‘æˆåŠŸ', 'success');
                    loadUserInfo();
                } else showMessage('configPage', 'è§£ç»‘å¤±è´¥: ' + data.error, 'error');
            } catch (error) { showMessage('configPage', 'ç½‘ç»œé”™è¯¯: ' + error.message, 'error'); }
        }
        
        async function deleteAccount() {
            const password = document.getElementById('deletePassword').value;
            if (!password) { showMessage('configPage', 'è¯·è¾“å…¥å¯†ç ç¡®è®¤åˆ é™¤', 'error'); return; }
            if (!confirm('âš ï¸ è­¦å‘Šï¼šæ­¤æ“ä½œå°†æ°¸ä¹…åˆ é™¤æ‚¨çš„è´¦æˆ·ï¼Œæ‰€æœ‰æ•°æ®å°†æ— æ³•æ¢å¤ï¼ç¡®å®šè¦ç»§ç»­å—ï¼Ÿ')) return;
            try {
                const response = await fetch('/api/dash/delete-account', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ password: password }) });
                const data = await response.json();
                if (data.code === 200) {
                    showMessage('configPage', 'è´¦æˆ·å·²æ°¸ä¹…åˆ é™¤', 'success');
                    currentUser = null;
                    setTimeout(() => { showPage('loginPage'); }, 2000);
                } else showMessage('configPage', 'åˆ é™¤å¤±è´¥: ' + data.error, 'error');
            } catch (error) { showMessage('configPage', 'ç½‘ç»œé”™è¯¯: ' + error.message, 'error'); }
        }
        
        async function logout() {
            try {
                const response = await fetch('/api/dash/logout', { method: 'POST' });
                const data = await response.json();
                if (data.code === 200) {
                    currentUser = null;
                    showPage('loginPage');
                } else showMessage('dashboardPage', 'é€€å‡ºå¤±è´¥: ' + data.error, 'error');
            } catch (error) { showMessage('dashboardPage', 'ç½‘ç»œé”™è¯¯: ' + error.message, 'error'); }
        }
        
        function showConfig() { showPage('configPage'); }
        
        function showMessage(pageId, message, type) {
            const messageArea = document.getElementById(pageId === 'loginPage' ? 'messageArea' : pageId === 'registerPage' ? 'registerMessageArea' : 'configMessageArea');
            messageArea.innerHTML = `<div class="message ${type}">${message}</div>`;
            setTimeout(() => { messageArea.innerHTML = ''; }, 3000);
        }
        
        window.addEventListener('hashchange', function() {
            hash = window.location.hash.substring(1);
            if (hash === 'login') showPage('loginPage');
            else if (hash === 'register') showPage('registerPage');
            else if (hash === 'dashboard' && isLoggedIn()) showPage('dashboardPage');
            else if (hash === 'config' && isLoggedIn()) showPage('configPage');
            else if (isLoggedIn()) showPage('dashboardPage');
            else showPage('loginPage');
        });
    </script>
</body>
</html>